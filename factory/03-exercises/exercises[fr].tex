\documentclass[12pt,a4paper]{scrartcl}

\usepackage[apmep, fr]{exercises}

% == FOR DOC AND TESTS - START == %

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{ucs}

\usepackage[french]{babel,varioref}

\usepackage{multicol}
\usepackage{subfig}
\usepackage{enumitem}

\usepackage{color}
\usepackage{hyperref}
\hypersetup{
    colorlinks,
    citecolor=black,
    filecolor=black,
    linkcolor=black,
    urlcolor=black
}

\usepackage{amsthm}

\usepackage{tcolorbox}
\tcbuselibrary{listingsutf8}

\usepackage{ifplatform}

\usepackage{xstring}

\usepackage{fancyvrb}


% MISC

\tcbset{%
	sharp corners,%
	left=1mm, right=1mm,%
	bottom=1mm, top=1mm,%
	colupper=red!75!blue%
}

\setlength{\parindent}{0cm}

\theoremstyle{definition}
\newtheorem*{remark}{Remarque}

\usepackage[raggedright]{titlesec}

\titleformat{\paragraph}[hang]{\normalfont\normalsize\bfseries}{\theparagraph}{1em}{}
\titlespacing*{\paragraph}{0pt}{3.25ex plus 1ex minus .2ex}{0.5em}

\makeatother
	\newcommand\resetallcnt{
		\setcounter{lyxam@counter@topic}{0}
		\setcounter{lyxam@counter@exercise}{0}
		\setcounter{lyxam@counter@problem}{0}
		\setcounter{lyxam@counter@bonus}{0}
		\setcounter{lyxam@counter@subpart}{0}
	}
\makeatletter

% Technical IDs

\newwrite\tempfile

\immediate\openout\tempfile=x-\jobname.macros-x.txt

\AtEndDocument{\immediate\closeout\tempfile}

\newcommand\IDconstant[1]{%
    \immediate\write\tempfile{constant@#1}%
}

\makeatletter
	\newcommand\IDmacro{\@ifstar{\@IDmacroStar}{\@IDmacroNoStar}}

    \newcommand\@IDmacroNoStar[3]{%
        \texttt{%
        	\textbackslash#1%
        	\IfStrEq{#2}{0}{}{%
        		\,\,[#2 Option%
				\IfStrEq{#2}{1}{}{s}]%
			}%
    	    \IfStrEq{#3}{}{}{%
	    		\,\,(#3 Argument%
				\IfStrEq{#3}{1}{}{s})%
			}
	   	}
        \immediate\write\tempfile{macro@#1@#2@#3}%
    }

    \newcommand\@IDmacroStar[2]{%
        \@IDmacroNoStar{#1}{0}{#2}%
    }

	\newcommand\@IDoptarg{\@ifstar{\@IDoptargStar}{\@IDoptargNoStar}}

	\newcommand\@IDoptargStar[2]{%
    	\vspace{0.5em}
		--- \texttt{#1%
			\IfStrEq{#2}{}{:}{\,#2:}%
		}%
	}

	\newcommand\@IDoptargNoStar[2]{%
    	\IfStrEq{#2}{}{%
			\@IDoptargStar{#1}{}%
		}{%
			\@IDoptargStar{#1}{\##2}%
		}%
	}

	\newcommand\IDkey[1]{%
    	\@IDoptarg*{Option}{{\itshape "#1"}}%
	}

	\newcommand\IDoption[1]{%
    	\@IDoptarg{Option}{#1}%
	}

	\newcommand\IDarg[1]{%
    	\@IDoptarg{Argument}{#1}%
	}
\makeatother

% == FOR DOC AND TESTS - END == %

\newenvironment{preambule}{}{}


\begin{document}

\newcommand\exosoptions{
\IDkey{pts} le nombre de points avec le cas particulier de $0$ qui demande d'afficher "Non noté".

\IDkey{time} la durée de l'exercice.

\IDkey{id} un texte de votre choix pour remplacer le numéro (ceci a pour effet de bloquer temporairement la numérotation).

\IDkey{title} un titre.

\IDkey{note} une petite indication liée à l'exercice (comme par exemple qu'il ne s'adresse qu'aux élèves motivés).

\IDkey{src} la source utilisée pour confectionner l'exercice.
}


\section{Indiquer vos exercices}

    \subsection{Important pour la suite}

%Rappelons que tous les exemples utilisés dans cette documentation ont été obtenus en utilisant \verb+\usepackage[apmep, fr]{lyxam}+ dans le préambule.

Rappelons que tous les exemples utilisés dans cette documentation ont été obtenus en utilisant \verb+\usepackage[fr]{lyxam}+ dans le préambule.


    \subsection{Différents types d'exercices}

Voici l'ensemble des commandes disponibles pour indiquer un type d'exercice.

% All kind of level 2 contexts - START
\begin{itemize}[label=\textbullet]
\makeatletter
    \item \verb+\activity+ correspond à "\lyxam@text@activity{}".
    
    \item \verb+\bonus+ correspond à "\lyxam@text@bonus{}".
    
    \item \verb+\exercise+ correspond à "\lyxam@text@exercise{}".
    
    \item \verb+\mcq+ correspond à "\lyxam@text@mcq{}".
    
    \item \verb+\praticalwork+ correspond à "\lyxam@text@praticalwork{}".
    
    \item \verb+\problem+ correspond à "\lyxam@text@problem{}".
\makeatother
\end{itemize}
% All kind of level 2 contexts - END

Dans la suite, nous donnerons des exemples principalement avec la commande \verb+\exercise+. Ceci n'est pas gênant car le principe reste identique pour les autres commandes.


    \subsection{Numérotation minimaliste}

En \textbf{compilant deux fois} au moins, \verb+lyxam+ va pouvoir donner une numérotation minimaliste de vos exercices. Tout d'abord, ci-dessous on obtient classiquement des exercices tous numérotés où vous noterez que chaque type d'exercice admet sa propre numérotation.


\begin{tcblisting}{}
\exercise
Bla, bla, bla, bla, bla, ...

\exercise
Bla, bla, bla, bla, bla, ...

\problem
Bla, bla, bla, bla, bla, ...

\problem
Bla, bla, bla, bla, bla, ...
\end{tcblisting}


Que souhaite-t-on avoir dans un sujet ne contenant qu'un seul problème et un seul bonus ? Nul besoin ici d'avoir un numéro pour ces derniers. C'est ce que fait \verb+lyxam+.

\resetallcnt{}

\begin{tcblisting}{}
\exercise
Bla, bla, bla, bla, bla, ...

\exercise
Bla, bla, bla, bla, bla, ...

\problem
Bla, bla, bla, bla, bla, ...

\bonus
Bla, bla, bla, bla, bla, ...
\end{tcblisting}



    \subsection{Indiquer le barème}

La commande \verb+\exercise+ dispose de plusieurs options dont l'une permet de donner le nombre de points attribués à un exercice où lorsque l'on indique $0$ point le package indique une exercice non noté (voir la section suivante pour un exemple). Voici comment donner un barème.

\resetallcnt{}

\begin{tcblisting}{}
\exercise[pts = 5]
Bla, bla, bla, bla, bla, ...
\end{tcblisting}


    \subsection{Toutes les options en action}

Les fiches techniques données un peu plus bas expliquent le champs d'utilisation de chaque option.

\begin{tcblisting}{}
\exercise[pts   = 0,
          time  = 3 jours,
          id    = facultatif,
          title = Devinette,
          about  = Pour spécialistes uniquement,
          src   = Le livre des experts]
Bla, bla, bla, bla, bla, ...
\end{tcblisting}



    \subsection{Cacher le texte "Exercice"}

La version étoilée \verb+\exercise*+ permet de cacher le contexte qui du point de vue de \verb+lyxam+ sera ici le texte "Exercice". Ceci est surtout pratique pour les sous-parties présentées un peu plus bas. Dans ce genre de situation, il faut obligatoirement donner un titre.

\begin{tcblisting}{}
\exercise*[title = Juste mon titre]

Bla, bla, bla, bla, bla, ...
\end{tcblisting}

    \subsection{Fiches techniques}

Toutes les options données ci-dessous sont facultatives.

\bigskip


% IDmacro - All kind of level 2 contexts - START
\IDmacro{activity}{6}{}

\IDmacro{bonus}{6}{}

\IDmacro{exercise}{6}{}

\IDmacro{mcq}{6}{}

\IDmacro{praticalwork}{6}{}

\IDmacro{problem}{6}{}
% IDmacro - All kind of level 2 contexts - END

\exosoptions{}



\section{Indiquer des sous-parties dans vos exercices}

    \subsection{Un exemple suffit\dots{} ou presque}

La commande \verb+\subpart+, avec les mêmes options que les commandes de type \verb+\exercice+, sert pour des sous-parties d'un exercice qui seront numérotées relativement aux exercices comme le montre l'exemple suivant.

\resetallcnt{}

\begin{tcblisting}{}
\exercise
\subpart
\subpart

\exercise
\subpart
\subpart
\end{tcblisting}


    \subsection{Fiche technique}

Toutes les options données ci-dessous sont facultatives et identiques à celles vues précédemment.

\bigskip


% IDmacro - All kind of level 3 contexts - START
\IDmacro{subpart}{6}{}
% IDmacro - All kind of level 3 contexts - END

\exosoptions{}



\section{Regrouper vos exercices par thèmes}

    \subsection{Un exemple suffit\dots{} ou presque}

La commande \verb+\topic+, avec les mêmes options que les commandes de type \verb+\exercice+, sert juste à regrouper des exercices par thématiques : fût un temps où dans les brevets du collège, il y avait une partie numérique et une autre géométrique.
Chaque nouvelle utilisation de \verb+\topic+ remet juste à zéro la numérotation des sous-parties mais pas celles des contextes de type \verb+\exercice+.

\resetallcnt{}

\resetallcnt{}

\begin{tcblisting}{}
\topic
\exercise
\exercise

\topic
\exercise
\end{tcblisting}


    \subsection{Fiche technique}

Toutes les options données ci-dessous sont facultatives et identiques à celles vues précédemment.

\bigskip


% IDmacro - All kind of level 1 contexts - START
\IDmacro{topic}{6}{}
% IDmacro - All kind of level 1 contexts - END

\exosoptions{}



\section{Utiliser un préambule}

L'environnement \verb+\preambule+ sans aucune option sert à rédiger un ou plusieurs paragraphes en préambule de quelque chose.

\resetallcnt{}

\resetallcnt{}

\begin{tcblisting}{}
\begin{preambule}
	Les exercices 1 et 2 sont indépendantes l'un de l'autre.
\end{preambule}

\exercise
\exercise
\end{tcblisting}


\end{document}
