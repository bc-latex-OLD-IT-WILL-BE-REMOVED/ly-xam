% == PACKAGES USED == %

\usepackage{pgfkeys}
\usepackage{xstring}


% == DEFINITIONS == %

\makeatletter
% Which style to use ?
    \newcommand{\@style@choosen}{default}
    \DeclareOption{default}{}
    \DeclareOption{apmep}{\renewcommand{\@style@choosen}{apmep}}

% Which language to use ?
    \newcommand{\@lang@choosen}{en}
    \DeclareOption{en}{}
    \DeclareOption{fr}{\renewcommand{\@lang@choosen}{fr}}

% Processing the options
    \ProcessOptions

% Loading the good language
    \IfStrEqCase{\@lang@choosen}{
        {en}{
            \input{config/lang/en.sty}
        }{fr}{
            \input{config/lang/fr.sty}
        }
    }

% Setting of the keys for the formatting and the infos of the @exam.
    \pgfkeys{
        /examkeys/.is family,
        /examkeys,
            kind/.initial      = {}, % "Homework" for example
            render/.initial    = no, % Render the subject or not
            nb/.initial        = 0,  % Number of the exam
            subnb/.initial     = {}, % For different subjects at the same time
            subject/.initial   = {}, % "Math" for example
            theme/.initial     = {}, % "Complex Numbers" for example
            sector/.initial    = {}, % "SÃ©rie scientifique" for example
            class/.initial     = {}, % Name of a class
            location/.initial  = {}, % An institute or a school
            date/.initial      = {}, % Date of the exam
            time/.initial      = {}, % Duration of the exam
            preambule/.initial = {}, % Main preambule
            @firstuse/.initial = 0
    }

% The general layout command.
    \newcommand\exam[1][]{%
% User's options
        \pgfkeys{/examkeys, #1}
        \pgfkeysgetvalue{/examkeys/@firstuse}{\@firstuse}

% First use ?
        \ifnum\@firstuse=1
            \PackageError{lyxam}{command 'exam' can be used only one time}
        \fi
        \pgfkeyssetvalue{/examkeys/@firstuse}{1}

% Management of the keys : we use public constants !
        \pgfkeysgetvalue{/examkeys/kind}{\examkind}
        \pgfkeysgetvalue{/examkeys/render}{\examrender}
        \pgfkeysgetvalue{/examkeys/nb}{\examnb}
        \pgfkeysgetvalue{/examkeys/subnb}{\examsubnb}
        \pgfkeysgetvalue{/examkeys/subject}{\examsubject}
        \pgfkeysgetvalue{/examkeys/theme}{\examtheme}
        \pgfkeysgetvalue{/examkeys/sector}{\examsector}
        \pgfkeysgetvalue{/examkeys/class}{\examclass}
        \pgfkeysgetvalue{/examkeys/location}{\examlocation}
        \pgfkeysgetvalue{/examkeys/date}{\examdate}
        \pgfkeysgetvalue{/examkeys/time}{\examtime}
        \pgfkeysgetvalue{/examkeys/preambule}{\exampreambule}

% Make the long time version.
        \if\relax\examkind\relax
        	\PackageError{lyxam}{the option 'kind' can't be empty}
		\fi

% Make the long time version.
        \newcommand\examlongtime{
	        \if\relax\examtime\relax \else
	        	\examduration{} : \examtime{}
	    	\fi
		}

% Building the layout.
        \@build@layout{}
    }


% Loading the good style
    \IfStrEqCase{\@style@choosen}{
        {apmep}{
            \input{config/style/apmep.sty}
        }{default}{
            \PackageError{lyxam}{no default layout for the moment}
        }
    }
\makeatother
