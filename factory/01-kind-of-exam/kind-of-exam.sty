% == PACKAGES USED == %

\usepackage{pgfkeys}
\usepackage{xstring}


% == DEFINITIONS == %

\makeatletter
% Which style to use ?
    \newcommand{\@style@choosen}{default}
    \DeclareOption{default}{}
    \DeclareOption{apmep}{\renewcommand{\@style@choosen}{apmep}}

% Which language to use ?
    \newcommand{\@lang@choosen}{en}
    \DeclareOption{en}{}
    \DeclareOption{fr}{\renewcommand{\@lang@choosen}{fr}}

% Processing the options
    \ProcessOptions

% Loading the good language
    \IfStrEqCase{\@lang@choosen}{
        {en}{\input{config/lang/en.sty}}%
        {fr}{\input{config/lang/fr.sty}}
    }

% Setting of the keys for the formatting and the infos of the @exam.
    \pgfkeys{
        /lyxam@examkeys/.is family,
        /lyxam@examkeys,
            kind/.initial      = {}, % "Homework" for example
            render/.initial    = no, % Render the subject or not
            nb/.initial        = 0,  % Number of the exam
            subnb/.initial     = {}, % For different subjects at the same time
            subject/.initial   = {}, % "Math" for example
            theme/.initial     = {}, % "Complex Numbers" for example
            sector/.initial    = {}, % "SÃ©rie scientifique" for example
            class/.initial     = {}, % Name of a class
            location/.initial  = {}, % An institute or a school
            date/.initial      = {}, % Date of the exam
            time/.initial      = {}, % Duration of the exam
            preambule/.initial = {}, % Main preambule
            @firstuse/.initial = 0
    }

% The general layout command.
    \newcommand\lyxam@longtime[1]{%
        \if\relax#1\relax \else
            \lyxam@text@duration{}: #1
        \fi%
    }

    \newcommand\exam[1][]{%
% User's options
        \pgfkeys{/lyxam@examkeys, #1}
        \pgfkeysgetvalue{/lyxam@examkeys/@firstuse}{\@firstuse}

% First use ?
        \ifnum\@firstuse=1
            \PackageError{lyxam}{command 'exam' can be used only one time}
        \fi
        \pgfkeyssetvalue{/lyxam@examkeys/@firstuse}{1}

% Management of the keys : we use public constants !
        \pgfkeysgetvalue{/lyxam@examkeys/kind}{\lyxam@kind}
        \pgfkeysgetvalue{/lyxam@examkeys/render}{\lyxam@render}
        \pgfkeysgetvalue{/lyxam@examkeys/nb}{\lyxam@nb}
        \pgfkeysgetvalue{/lyxam@examkeys/subnb}{\lyxam@subnb}
        \pgfkeysgetvalue{/lyxam@examkeys/subject}{\lyxam@subject}
        \pgfkeysgetvalue{/lyxam@examkeys/theme}{\lyxam@theme}
        \pgfkeysgetvalue{/lyxam@examkeys/sector}{\lyxam@sector}
        \pgfkeysgetvalue{/lyxam@examkeys/class}{\lyxam@class}
        \pgfkeysgetvalue{/lyxam@examkeys/location}{\lyxam@location}
        \pgfkeysgetvalue{/lyxam@examkeys/date}{\lyxam@date}
        \pgfkeysgetvalue{/lyxam@examkeys/time}{\lyxam@time}
        \pgfkeysgetvalue{/lyxam@examkeys/preambule}{\lyxam@preambule}

% Make the long time version.
        \if\relax\lyxam@kind\relax
              \PackageError{lyxam}{the option 'kind' can't be empty}
            \fi

% Building the layout.
        \@build@layout{}
    }


% Loading the good style
    \IfStrEqCase{\@style@choosen}{
        {apmep}{\input{config/style/apmep.sty}}%
        {default}{\PackageError{lyxam}{no default layout for the moment}}
    }
\makeatother
