% == PACKAGES USED == %

\RequirePackage{fancyhdr}
\RequirePackage{lastpage}

\RequirePackage{calc}
\RequirePackage{etoolbox}
\RequirePackage{listofitems}
\RequirePackage{simplekv}
\RequirePackage{xstring}


% == COMMON SETTINGS == %

% Which style to use ?
\newcommand{\@style@choosen}{apmep}
% \newcommand{\@style@choosen}{default}
% \DeclareOption{default}{}
\DeclareOption{apmep}{\renewcommand{\@style@choosen}{apmep}}

% Which language to use ?
\newcommand{\@lang@choosen}{en}
\DeclareOption{en}{}
\DeclareOption{fr}{\renewcommand{\@lang@choosen}{fr}}


% == LOCAL SETTINGS == %

% Headers and footers or not ?
\newbool{@lyxam@show@headers@footers}
\setbool{@lyxam@show@headers@footers}{true}

\DeclareOption{hf}{}
\DeclareOption{nohf}{\setbool{@lyxam@show@headers@footers}{false}}


% == PROCESSING OPTION - LOADING LANG == %

% Processing the options
\ProcessOptions

% Loading the good language
\IfStrEqCase{\@lang@choosen}{
    {en}{\input{config/lang/en.sty}}%
    {fr}{\input{config/lang/fr.sty}}
}


% == COMMON DEFINITIONS == %

% Source:
%    * https://tex.stackexchange.com/a/53091/6880
%
%    #1: value to test
%    #2: used if empty
%    #3: used if none empty
\newcommand\@if@empty[3]{%%
    \setbox0=\hbox{#1\unskip}\ifdim\wd0=0pt #2\else#3\fi%%
}


% == LOCAL DEFINITIONS == %

% General API Tools
\newbool{@lyxam@show@deliver}
\setbool{@lyxam@show@deliver}{false}

\newcommand\@use@lyxam@key[1]{\useKV[lyxam@keys]{#1}}

% Layout API Tools
\newcommand\@lyxam@longduration[1]{%%
    \IfStrEq{#1}{}{}{\lyxam@text@duration{}: #1}%%
}

% The general layout command.
\setKVdefault[lyxam@keys]{%
    deliver  = false, % Deliver the subject or not to the teacher
    kind     = Test,  % "Homework" for example
    nb       = {},    % Number of the exam
    subnb    = {},    % For different subjects at the same time
    subject  = {},    % "Math" for example
    theme    = {},    % "Complex Numbers" for example
    sector   = {},    % "SÃ©rie scientifique" for example
    class    = {},    % Name of a class
    location = {},    % An institute or a school
    date     = {},    % Date of the exam
    time     = {}     % Duration of the exam
}

\newcommand\exam[1][]{%
    \useKVdefault[lyxam@keys]
    \setKV[lyxam@keys]{#1}
% Boolean key
    \ifboolKV[lyxam@keys]{deliver}{%%
        \setbool{@lyxam@show@deliver}{true}%%
    }{%%
        \setbool{@lyxam@show@deliver}{false}%%
    }%%
% Other keys
    \def\@lyxam@kind{\@use@lyxam@key{kind}}%%
    \def\@lyxam@nb{\@use@lyxam@key{nb}}%%
    \def\@lyxam@subnb{\@use@lyxam@key{subnb}}%%
    \def\@lyxam@subject{\@use@lyxam@key{subject}}%%
    \def\@lyxam@theme{\@use@lyxam@key{theme}}%%
    \def\@lyxam@sector{\@use@lyxam@key{sector}}%%
    \def\@lyxam@class{\@use@lyxam@key{class}}%%
    \def\@lyxam@location{\@use@lyxam@key{location}}%%
    \def\@lyxam@date{\@use@lyxam@key{date}}%%
    \def\@lyxam@time{\@use@lyxam@key{time}}%%
    \@build@layout{}
}


% == LOADING THE STYLE == %

% Loading the good style
\IfStrEqCase{\@style@choosen}{
    {apmep}{\input{config/style/apmep.sty}}%
}

% == END == %
